デモのプレイ可能セクションのディヴェロッパー各位

このディレクトリには、フル・デモ・ディスクのためのシンプルなブートストラップ・プログラムBSが含まれています。 臨時(そう、臨時です)の変更を行う必要がある場合のために、BSのソース、bs.exe製作用メークファイル、そしてエミュレータ上でBSによるロード・実行用にプログラム例をレイアウトする方法を示すcti例ファイルが含まれています。 bsは、特別に構築されたフル・ライブラリのサブセットbs.libを使用しています。 Bs.cとbs.libの著作権は、SCEEが所有しています。

BSは何を行いますか?

基本的には、BSはマシンを起動し、どうしようもないアイコンを表示して、その後CD上の最初の実行可能プログラム(トラック0、0分、2秒、セクタ35にあるプログラム)を実行します。CDまたはCTIファイルの最初にプログラムを配置すると、BSはそのプログラムをロードして実行します。 次のように、プレイ可能セクションをテストできます：bs.exe psx.exeをコールして、例えばridge.exeと呼ばれるゲームを、ディスクの最初のプログラムにします。 実際のデモ・ディスクでは、動作が異なります　-　メイン・デモ・メニュー・プログラムがディスクで最初のプログラムになり、このプログラムが特定のゲームの論理位置を見つけ、BSを使用してロードします。
しかし、テストのためには、BSにメイン・プログラムをロードさせてください。何らかの理由でこれが不可能な場合、私まで連絡するか、BSソースを臨時に変更してください。

コードがすべてOKで、すべてが正常なら、開発システムはホストにprintfします:

<BSヒープ、データ位置などについて>
<次に、PadInit()からのメッセージ>
<最後に:>

BS: Set loc for seek
BS: Program go.

この時点で、BSはプログラムを検索してロード中になっています。 直後に、プログラムが実行されます。 何かうまく行っていない場合、BSはタイムアウトして、マシンを再起動します。 これはおそらく何回も再起動を起こしますが、さて、どうなっているでしょうか。 これで、プログラムが実行されます。 

実行可能プログラムは、.EXEファイルの始めのXF_HDRデータに従ってロードされます。要するに、正しい情報が入っていなければ、すべてが失われます。t_addrフィールドで指定したアドレスにプログラムがロードされ、bssがクリアされます。 

*** 重要な項目***
cpe2xは、スタック・ポインタを正しく設定しません。 しかし、bsは、あなたがスタックをどこに配置したいかを想定できません! そのため、スタック・ポインタを検索するために使用できるプログラムを提供しました(setspディレクトリに入っています)。 次のようにタイプしてください: setsp <プログラム名.exe> <スタックのアドレス>

表示されるアドレスはスタックの最上位アドレスです；スタックは、下向きになっていることを忘れないでください。
これを、メークファイルに入れると良いでしょう。 これで、bsはスタックをどこに入れるかがわかるようになります。これをし忘れると、スタック・アドレスがめちゃくちゃな値に設定され、コードがクラッシュします。 

***問題! ****

ゲームが停止したら、開発システムは次のようにprintfします:

BS: Returned ok; load Game: 0.

この後、もう一度ゲームがロードされます　-　つまり、上記の表示が繰り返されます。
すべてがOKなら、次のことが起こるはずです：
1) ゲームが起動するはずです
2) コードがnone2.lib (readme参照)にリンクされているなら、BSに戻るはずです
3) none2.libがBSコードを保つため、BSが正常に動作するはずです
4) (1)から(3)までのプロセスが2回以上繰り返されます。

勿論、ゲームの内部で0x80010000 -> 0x80018000の間に書き込むと、BSを壊すことになります。

見かけほど単純ではないのは確かですが... :-) 絶対にうまく行きます。

問題がある場合、私や、テクニカル・サポートまでご連絡下さい。

Allan.
