# PSYQ field-truth plan (2025-09-29)

This checklist formalises how we validate the crate-domain predictions against
runtime PSYQ call traces. Use it alongside `exports/psyq_field_truth_sheet.csv`
which is generated by `scripts/prepare_field_truth_sheet.py`.

## Checklist workflow

1. Refresh the data pipeline (crate matrix, domain pivots, PSYQ priorities).
2. Run `scripts/prepare_field_truth_sheet.py` (defaults to `high` + `second`
   priority crates). This emits `exports/psyq_field_truth_sheet.csv` with one
   row per crate slot, including value IDs, domains, crossref totals, and the
   PSYQ focus hints.
3. Load the CSV in your spreadsheet editor and add columns if needed for
   tester names or session IDs. The sheet already includes empty fields for
   `observed_psyq_calls` and free-form notes per slot.
4. In Ghidra, attach instrumentation/breakpoints around the crate loader and
   log PSYQ library calls (`libgte`, `libgpu`, `libspu`, `libpad`). Record the
   observed call signatures in the sheet. Aim to confirm the predicted focus
   hint (for example, whether a combat-heavy slot really drives `libgpu`
   primitives) or flag discrepancies.
5. When a slot is verified, mark the row with consistent terminology (e.g.
   `verified`, `partial`, `mismatch`). Keep mismatches for follow-upâ€”export a
   filtered CSV of non-confirmed rows to drive the next tracing session.
6. Regenerate `exports/psyq_field_truth_progress.md` via
   `scripts/summarize_field_truth_progress.py` to visualize completion rates
   by priority and crate.
7. To plan the next session, run `scripts/recommend_field_truth_targets.py`
   for an at-a-glance list of the highest crossref slots awaiting validation
   in `exports/psyq_field_truth_next.md`.
8. Capture new observations with `scripts/update_field_truth_slot.py`
   (supports dry-run, append, observer metadata, and automatic backups).
9. Automate headless tracing by generating `exports/ghidra_field_truth_job.json`
   with `scripts/generate_ghidra_field_truth_job.py`. The JSON can be fed into
   your Ghidra automation wrapper to batch-run the tracer script across the
   queued crates/slots.
10. Need ready-to-run shell commands? Execute
   `scripts/emit_ghidra_headless_commands.py` to emit PowerShell or bash
   command lists (`exports/ghidra_headless_commands.ps1` by default) that wrap
   `analyzeHeadless` with the appropriate crate/slot parameters.

## Tips

- Always keep the `psyq_trace_targets.csv` output handy; it timestamps the
  priority ranking used when the sheet was produced.
- If you instrument a crate outside the selected priorities, rerun the script
  with `--priorities high second watch` (or any tiers you need) to regenerate a
  tailored sheet.
- Pair the sheet with `exports/psyq_focus_report.md` to pick domain specialists
  (AI/render/support) for each session.
- Commit the updated sheet (or a sanitised copy) after each tracing batch to
  track historical progress.
