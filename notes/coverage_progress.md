# Reverse Engineering Coverage Progress

(Updated dynamically)  

## Legend

- 0–10%: stub awareness only
- 10–30%: structural mapping (calls, constants) known
- 30–60%: major entry points labeled, data flow partially understood
- 60–85%: behavior reproducible with high confidence (edge cases missing)
- 85–100%: near-complete; timings/edge cases & data formats validated

## Current Subsystem Coverage

| Subsystem | % | Status / Notes | Key Artifacts |
|-----------|---|----------------|---------------|
| Main Frame Loop | 40% | Call list enumerated, coarse segmentation; internal sequencing partly classified | `main_update`, logic/frame maps |
| Input Dispatch (Pad) | 55% | Crate-related masks mapped (0x40,0x10); other action bits pending | `input_decode_dispatch`, bit helpers |
| Crate Interaction (Pickup/Throw) | 95% | Final names + scheduler contract confirmed; slots (+0x38/+0x3c/+0x40) mapped; labeled callback summary; minor return-predicate notes pending | `crate_reference.md`, `crate_final_mapping.md` |
| State Scheduler Core | 60% | Enqueue stub + paired callbacks identified; other actor types undiscovered | `crate_state_scheduler_enqueue`, callback pair |
| Physics Integrator (2D/3D core) | 45% | Confirmed vel ( +0x100/+0x102 ) → pos ( +0x114/+0x118 ) integrator with >>0xC scaling; composed caller→integrator chain isolated (FUN_0001f218→FUN_00040a98); new detector mapped additional Q12 pos updates (see physics_integrator_map.md) | `phys_FUN_000406ac`, `gravity_composed_integrators.md`, `physics_integrator_map.md` |
| Orientation / Direction Tables | 70% | sin/cos tables extracted (0x26800/0x27800); high-score role inference (normalization vs matrix setup) completed | `FUN_00022e5c` callers, `orientation_roles.md` |
| Animation / Effects | 15% | Secondary callback & large routine placeholder; semantics unknown | `crate_anim_fx_step` (FUN_00035cc0) |
| Rendering Primitive Build | 10% | Only indirect evidence via large funcs and scheduling; no primitive types decoded | large unidentified funcs |
| CD Streaming | 45% | Init, poll, stage, memcpy, control ring mapped; asset linkage TBD | `cdstream_*` functions |
| Resource Formats (BUDDIES.DAT etc.) | 5% | Not parsed; only container presence recognized | data files list |
| Audio (XA / SFX pump) | 10% | XA containers present; no mixing/update logic yet mapped | *.XA files |
| AI Behavior / Action Jump Table | 18% | Jump table (0x4B entries) seen indirectly; crate-related raw FUN_* names recovered aiding call path narrowing | indirect jump @ -0x7ff38914 |
| Mission / Objective Logic | 0% | No routines tagged yet | - |
| UI / HUD | 5% | Sparse input helpers; no draw routines mapped | suspect input funcs |
| Memory Card Handling | 0% | Game-specific handling not inspected | - |
| Camera System | 5% | Implicit via orientation routines only | orientation snippets |
| Particles / FX Systems | 5% | Possibly inside FUN_00035cc0; unconfirmed | FUN_00035cc0 |
| Multiplayer / Player Multiplex | 0% | Not yet investigated | - |

## Automated Coverage Crosswalk (Refined Categories Snapshot)

This section reconciles the new automated category counts (from `exports/mapping_coverage_report.md`) with the manually estimated subsystem percentages above. Automated categories are generated by pattern & heuristic scripts; manual percentages reflect depth of semantic understanding (not just raw tagging). Use this crosswalk to keep both views aligned.

| Manual Subsystem | Related Automated Categories | Raw Function Counts (distinct) | Approx Share of Total | Notes / Reconciliation |
|------------------|------------------------------|-------------------------------:|-----------------------:|------------------------|
| Physics Integrator (incl. vertical motion aspects) | vertical_core (27) + vertical_consumer (329) + gravity (9) | 365 | 16.17% | Structural tall; semantic understanding still maturing for many consumers. Velocity axis roles resolved (3/3). Magnitude scalar reuse pattern established. Direction basis locked (3/3). |
| Animation / Effects / Particles | vertical_consumer subset | (subset of 329) | — | Requires tagging refinement to isolate pure FX vs motion math. |
| Crate Interaction | crate (166) + pickup_drop (162) | 328 | 14.53% | High structural coverage; semantics deeply mapped. |
| Input Dispatch | input (69) | 69 | 3.06% | Remaining unlabeled input hubs under review. |
| CD Streaming | cdstream (125) | 125 | 5.54% | Core streaming logic identified; asset linkage pending. |
| Orientation / Direction Tables | orientation (13) | 13 | 0.58% | Derived from trig mask & table reference heuristic. |

## Recent Milestones

Recent wins across orientation and gravity triage:

- (Update) Intersections report enriched with TopOverlap/TopOverlap2, overlap density bonus, and neighbor mini‑snippets for faster gravity chain triage (`exports/gravity_chain_intersections.md`).
- (Update) Crate system finalized: pickup/throw writers labeled, scheduler callback pairs summarized with labels, and reference made rebuild-safe via preserved Confirmed Entry Points block (`exports/crate_reference.md`, `exports/crate_final_mapping.md`).

## Next Immediate Targets

1. Gravity sibling clustering: enumerate additional callers sharing struct offsets with FUN_0001f218 to expand composed chains.
2. Deep callee scan: inspect integrator callees with vertical+shift signatures to locate Y-component accumulation.
3. Orientation refinement: split camera matrix setup vs. generic angle normalization using COP usage & dual trig pair density.
4. Integrate role & chain metrics into automated crosswalk / dashboard (augment coverage table with semantic depth score).
5. Input hub enrichment pass: auto-detect remaining pad bit semantics & crate/pickup linkage.
6. Pointer-chase vertical cluster ( * (param + 0x11C) ) to confirm secondary struct housing gravity fields.
7. Enumerate indirect jump table entries (0x4B states) for action taxonomy.
8. Classify `FUN_00035cc0` (primitive emission vs animation step) via primitive pattern probes.
9. Triage top overlap candidates using neighbor mini‑snippets (e.g., FUN_00022dc8, FUN_0003b264) to confirm additional composed chains.
10. Build trig orientation reproduction harness to validate update + wrap semantics for top role classes.

## Update Protocol

- After each RE batch: adjust percentages, log delta in a new "Changelog" entry below.

## Changelog

- (Init) Created coverage dashboard with baseline percentages.
- (Update) Physics integrator offsets validated (+0x100/+0x102 vel, +0x114/+0x118 pos); orientation hashing via FUN_00022e5c confirmed, coverage metrics bumped.
- (Update) Gravity scan (candidate Y offsets +0x10c..+0x11c, +0x110/+0x112 etc.) yielded no matches; next pass will broaden to structure regions near 0xea counter and look for decrement patterns against a constant each frame.
- (Update) Raw crate function names (FUN_* signatures) recovered; crate-path negative mutation scan (depth 5) still no literal gravity.
- (Update) Vertical candidate enumeration & annotated decomp added (`vertical_candidate_analysis.md`); cluster identified at offsets 0x11A–0x120 with repeated init writes and negative constants (likely secondary struct pointer / vertical vector indirection).
- (Update) Fuzzy gravity scanner produced 80 candidate link groups (`gravity_fuzzy_candidates.md`); pattern suggests +0x11C frequently used as pointer, prompting pointer-chase approach.
- (Update) Trig table locator heuristic executed (`trig_table_locator.md`); multiple &0xFFF + long-constant functions isolated; extraction scaffold ready pending base confirmation.
- (Update) Multi-segment trig probe found sin/cos arrays (0x26800 & 0x27800); dump generated (`direction_table_dump.txt`) with meanR≈4096.
- (Update) Orientation focus extractor v2 added bundle fallback; contexts now populated for 16 high-score functions.
- (Update) Orientation role inference classified candidates (matrix setup vs normalization); orientation coverage raised to 70%.
- (Update) Gravity neighborhood extended; composed chain FUN_0001f218→FUN_00040a98 isolated and ranked; physics integrator coverage nudged to 35%.
- (Update) Crate interaction finalized (naming + scheduler): added labels map and enriched reference with per-slot callback summary; build script now preserves confirmed-entry-points block; coverage raised to 95%.
- (Update) Ran automated Q12 integrator detector; produced `physics_integrator_map.{csv,md}` and `physics_integrator_candidates.md`, confirming multiple direct pos += (...) >> 0xC writers; Physics Integrator coverage raised to 45%.
- (Update) Crates: Added explicit cb2 predicate for base return in `crate_stateframe_cb_primary` (base slot write under condition), deduped fallback predicates, and introduced Base Return Drivers + Return Linkages sections in crate reference.

## New Semantic Derivations

### Orientation Roles Summary

| Role | Count |
|------|------:|
| matrix_apply_or_camera_setup | 1 |
| angle_normalization_update | 6 |
| trig_lookup_transform | 0 |
| angle_wrap_only | 8 |
| misc_orientation_candidate | 1 |

### Gravity Chains

| Caller | Integrator | Score | Notes |
|--------|------------|------:|-------|
| FUN_0001f218 | FUN_00040a98 | 17.90 | Caller supplies spatial refs; integrator performs shifts & vertical usage |

_Additional chains expected after sibling clustering & callee deep scan._
